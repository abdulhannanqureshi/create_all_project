{"ast":null,"code":"import _regeneratorRuntime from \"C:/xampp/htdocs/coinfield/coinfied/frontend/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/xampp/htdocs/coinfield/coinfied/frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"C:/xampp/htdocs/coinfield/coinfied/frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"C:/xampp/htdocs/coinfield/coinfied/frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from 'react';\nimport clsx from 'clsx';\nimport Swal from 'sweetalert2'; // import CreditCardInput from 'react-credit-card-input';\n\nimport { ApiHelper } from 'helper';\nimport { ApiRoutes } from 'config';\nimport makeStyles from '@material-ui/core/styles/makeStyles';\nimport useTheme from '@material-ui/core/styles/useTheme';\nimport Toast from 'components/toaster';\nimport Button from '@material-ui/core/Button';\nimport TextField from '@material-ui/core/TextField';\nimport Box from '@material-ui/core/Box';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport blue from '@material-ui/core/colors/blue';\nimport { Section, SectionAlternate } from 'components/organisms';\nimport { HeroBackground } from 'components/organisms';\nimport router from 'next/router';\nvar useStyles = makeStyles(function (theme) {\n  return {\n    root: {\n      '& .MuiTextField-root': {\n        backgroundColor: '#fff'\n      }\n    },\n    sectionDescription: {\n      background: blue[900]\n    },\n    sectionAlternateForm: {\n      background: 'transparent',\n      backgroundImage: \"linear-gradient(180deg, \".concat(theme.palette.background.paper, \" 300px, \").concat(theme.palette.primary.dark, \" 0%)\")\n    },\n    textWhite: {\n      color: '#fff'\n    },\n    error_msg: {\n      color: \"red\"\n    },\n    heroContainer: {\n      minWidth: \"1236px\"\n    },\n    contentSection: {\n      minHeight: \"500px\",\n      position: \"relative\",\n      '& p': {\n        fontSize: \"18px\",\n        lineHeight: \"28px\"\n      }\n    },\n    sectionHeader: {\n      paddingBottom: \"30px\",\n      borderBottom: \"1px solid #ddd\",\n      marginBottom: \"20px\"\n    },\n    creditInput: {\n      border: '5px solid #000'\n    },\n    listItem: {\n      display: 'flex',\n      justifyContent: 'space-between'\n    },\n    modualWrap: {\n      borderBottom: \"1px solid #ddd\",\n      marginBottom: \"20px\"\n    },\n    modualAmount: {\n      width: \"100px\",\n      fontWeight: \"700\"\n    },\n    modualList: {\n      fontSize: \"18px\",\n      position: \"relative\",\n      paddingLeft: \"20px\",\n      paddingBottom: \"20px\",\n      fontWeight: \"300\",\n      color: \"#020202\",\n      '&::before': {\n        content: ' \"\" ',\n        display: \"block\",\n        width: \"10px\",\n        height: \"10px\",\n        position: \"absolute\",\n        backgroundColor: '#000',\n        top: '5px',\n        left: '0px',\n        borderRadius: \"50%\"\n      }\n    },\n    calculationBlock: {\n      paddingBottom: \"15px\"\n    },\n    calcTitle: {\n      paddingRight: \"20px\",\n      textAlign: \"right\",\n      width: \"calc(100% - 100px)\",\n      fontSize: '18px'\n    },\n    calcValue: {\n      width: \"100px\",\n      fontSize: '18px',\n      fontWeight: '800'\n    },\n    apply_btn: {\n      width: \"200px\"\n    },\n    paymentWrap: {\n      backgroundColor: \"#eeeeee85\",\n      border: \"1px solid #ddd\"\n    },\n    paymentLoader: {\n      position: 'absolute',\n      zIndex: '10',\n      top: '0',\n      left: '0',\n      width: '100%',\n      height: '100%',\n      background: '#fff',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      flexDirection: 'column'\n    }\n  };\n});\n\nvar OrderDetail = function OrderDetail() {\n  var classes = useStyles();\n\n  var _useState = useState(false),\n      loader = _useState[0],\n      setLoader = _useState[1];\n\n  var _useState2 = useState(false),\n      couponLoader = _useState2[0],\n      setCouponLoader = _useState2[1];\n\n  var _useState3 = useState(false),\n      paymentloader = _useState3[0],\n      setPaymentLoader = _useState3[1];\n\n  var _useState4 = useState(''),\n      cardNumber = _useState4[0],\n      setCardNumber = _useState4[1];\n\n  var _useState5 = useState(''),\n      expiry = _useState5[0],\n      setExpiry = _useState5[1];\n\n  var _useState6 = useState(''),\n      cvc = _useState6[0],\n      setCvc = _useState6[1];\n\n  var _useState7 = useState(''),\n      courseData = _useState7[0],\n      setCourseData = _useState7[1];\n\n  var _useState8 = useState([]),\n      modualList = _useState8[0],\n      setModualList = _useState8[1];\n\n  var _useState9 = useState([]),\n      modualFinal = _useState9[0],\n      setModualFinal = _useState9[1];\n\n  var _useState10 = useState(0),\n      countTotal = _useState10[0],\n      setCountTotal = _useState10[1];\n\n  var _useState11 = useState(''),\n      error = _useState11[0],\n      setError = _useState11[1];\n\n  var _useState12 = useState(''),\n      coupanValue = _useState12[0],\n      setCoupanValue = _useState12[1];\n\n  var _useState13 = useState(''),\n      coupanCode = _useState13[0],\n      setCoupanCode = _useState13[1];\n\n  var _React$useState = React.useState({\n    values: {\n      firstName: '',\n      lastName: '',\n      email: '',\n      couponValue: '',\n      cardHolderName: ''\n    }\n  }),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      formState = _React$useState2[0],\n      setFormState = _React$useState2[1];\n\n  var _useState14 = useState({\n    border: '2px solid #ccc'\n  }),\n      fieldStyle = _useState14[0],\n      setFieldStyle = _useState14[1];\n\n  var _useState15 = useState({\n    fontSize: '16px'\n  }),\n      inputStyle = _useState15[0],\n      setInputStyle = _useState15[1];\n\n  var _useState16 = useState({\n    width: '100%'\n  }),\n      containerStyle = _useState16[0],\n      setContainerStyle = _useState16[1];\n\n  var theme = useTheme();\n  var isMd = useMediaQuery(theme.breakpoints.up('md'), {\n    defaultMatches: true\n  });\n  useEffect(function () {\n    var localData = localStorage.getItem('orderDetails');\n\n    if (localData) {\n      var courseId = JSON.parse(localData).courseId;\n\n      if (courseId) {\n        fetchUserData();\n        fetchData(courseId);\n      } else {\n        router.push('/courses');\n      }\n    } else {\n      router.push('/courses');\n    }\n  }, []);\n  useEffect(function () {\n    var localData = localStorage.getItem('orderDetails');\n    var modualData = JSON.parse(localData).modualData;\n\n    if (modualList.length > 0) {\n      var filteredList = modualList.filter(function (item) {\n        return modualData.includes(item._id);\n      });\n      setModualFinal(filteredList);\n\n      var _countTotal = filteredList.map(function (item) {\n        return item.amount;\n      }).reduce(function (prev, next) {\n        return parseInt(prev) + parseInt(next);\n      });\n\n      setCountTotal(_countTotal);\n    }\n  }, [modualList]);\n\n  var handleCardNumberChange = function handleCardNumberChange(event) {\n    setCardNumber(event.target.value);\n  };\n\n  var handleCardExpiryChange = function handleCardExpiryChange(event) {\n    setExpiry(event.target.value);\n  };\n\n  var handleCardCVCChange = function handleCardCVCChange(event) {\n    setCvc(event.target.value);\n  };\n\n  var handleChange = function handleChange(event) {\n    event.persist();\n    setFormState(function (formState) {\n      return _objectSpread(_objectSpread({}, formState), {}, {\n        values: _objectSpread(_objectSpread({}, formState.values), {}, _defineProperty({}, event.target.name, event.target.value))\n      });\n    });\n    setError(\"\");\n  };\n\n  var fetchData = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(id) {\n      var response, data, modualData;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setLoader(true);\n              _context.next = 3;\n              return new ApiHelper().FetchFromServer(ApiRoutes.COURSEDETAILS.service, ApiRoutes.COURSEDETAILS.url.replace(\":id\", id), ApiRoutes.COURSEDETAILS.method, ApiRoutes.COURSEDETAILS.authenticate, undefined, undefined, id);\n\n            case 3:\n              response = _context.sent;\n\n              if (response && !response.isError) {\n                data = response.data.data.course;\n                modualData = response.data.data.moduleDetails;\n                setCourseData(_objectSpread(_objectSpread({}, courseData), {}, {\n                  data: data\n                }));\n                setModualList(modualData);\n                setLoader(false);\n              } else {\n                Toast.fire({\n                  icon: 'error',\n                  title: \"Something went wrong\"\n                });\n              }\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function fetchData(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var fetchUserData = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var response, data;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return new ApiHelper().FetchFromServer(ApiRoutes.GETUSERDETAILS.service, ApiRoutes.GETUSERDETAILS.url, ApiRoutes.GETUSERDETAILS.method, ApiRoutes.GETUSERDETAILS.authenticate, undefined, undefined, undefined);\n\n            case 2:\n              response = _context2.sent;\n\n              if (response && !response.isError) {\n                data = response.data.data;\n                setFormState(function (formState) {\n                  return _objectSpread(_objectSpread({}, formState), {}, {\n                    values: {\n                      firstName: data.firstName,\n                      lastName: data.lastName,\n                      email: data.email\n                    }\n                  });\n                });\n                setLoader(false);\n              } else {\n                Toast.fire({\n                  icon: 'error',\n                  title: \"Something went wrong\"\n                });\n                router.push('/signin');\n                localStorage.setItem('orderDetails', '');\n              }\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function fetchUserData() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleApplyCoupon = function handleApplyCoupon() {\n    if (!formState.values.couponValue) {\n      setError(\"Please enter a valid Coupon code\");\n    } else {\n      setCouponLoader(true);\n      setCoupanValue(formState.values.couponValue);\n      applyCoupon({\n        'promoCode': formState.values.couponValue,\n        'moduleId': modualFinal\n      });\n    }\n  };\n\n  var applyCoupon = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(data) {\n      var response, _data;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return new ApiHelper().FetchFromServer(ApiRoutes.APPLYCOUPON.service, ApiRoutes.APPLYCOUPON.url, ApiRoutes.APPLYCOUPON.method, ApiRoutes.APPLYCOUPON.authenticate, undefined, data);\n\n            case 2:\n              response = _context3.sent;\n\n              if (response && !response.isError) {\n                _data = response.data.data;\n                setCoupanCode(_data);\n                setCouponLoader(false);\n              } else {\n                Toast.fire({\n                  icon: 'error',\n                  title: response.messages[0]\n                });\n                setCouponLoader(false);\n              }\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function applyCoupon(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handlePayment = function handlePayment() {\n    if (cardNumber === '' || expiry === '' || cvc === '') {\n      Swal.fire('Please fill required details');\n      return;\n    } else {\n      var localData = localStorage.getItem('orderDetails');\n      var modualData = JSON.parse(localData).modualData;\n      var _formState$values = formState.values,\n          firstName = _formState$values.firstName,\n          lastName = _formState$values.lastName,\n          email = _formState$values.email,\n          cardHolderName = _formState$values.cardHolderName;\n      var card_exp_month = expiry.slice(0, 2);\n      var card_exp_year = expiry.substring(5, 7);\n      var data = {\n        email: email,\n        name: \"\".concat(firstName).concat(lastName),\n        cardNumber: cardNumber.replace(/\\s/g, \"\"),\n        cardExpMonth: card_exp_month,\n        cardExpYear: card_exp_year,\n        cardCvc: cvc,\n        cardName: cardHolderName,\n        promoId: coupanCode.promoId,\n        moduleId: modualFinal\n      };\n      makePayment(data);\n    }\n  };\n\n  var makePayment = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(data) {\n      var response, _data2;\n\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              setPaymentLoader(true);\n              _context4.next = 3;\n              return new ApiHelper().FetchFromServer(ApiRoutes.MAKEPAYMENT.service, ApiRoutes.MAKEPAYMENT.url, ApiRoutes.MAKEPAYMENT.method, ApiRoutes.MAKEPAYMENT.authenticate, undefined, data);\n\n            case 3:\n              response = _context4.sent;\n\n              if (response && !response.isError) {\n                _data2 = response.data.data;\n                Toast.fire({\n                  icon: 'success',\n                  title: \"Payment successfull\"\n                });\n                setPaymentLoader(false);\n                localStorage.setItem('orderDetails', '');\n                alertBox();\n              } else {\n                Toast.fire({\n                  icon: 'error',\n                  title: response.message\n                });\n              }\n\n            case 5:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function makePayment(_x3) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var alertBox = function alertBox() {\n    Swal.fire({\n      title: 'Your Order has been Successfully Placed',\n      showDenyButton: false,\n      showCancelButton: false,\n      confirmButtonColor: '#3085d6',\n      confirmButtonText: 'Go  To Dashboard'\n    }).then(function (result) {\n      if (result.isConfirmed) {\n        router.push('/dashboard');\n      }\n    });\n  };\n\n  return __jsx(\"div\", null, __jsx(HeroBackground, {\n    backgroundColor: \"#5120FF\"\n  }, __jsx(Section, {\n    className: classes.heroContainer\n  }, __jsx(Grid, {\n    container: true,\n    spacing: isMd ? 4 : 2\n  }, __jsx(Grid, {\n    item: true,\n    xs: 12,\n    sm: 12,\n    md: 12,\n    \"data-aos\": \"fade-up\"\n  }, __jsx(Typography, {\n    variant: isMd ? 'h3' : 'body1',\n    className: clsx(classes.textWhite, classes.fontWeight700)\n  }, \"Order Detail\"))))), __jsx(Section, {\n    className: classes.contentSection\n  }, paymentloader ? __jsx(\"div\", {\n    className: classes.paymentLoader\n  }, __jsx(Box, null, __jsx(CircularProgress, null)), __jsx(Box, {\n    pt: 2\n  }, __jsx(Typography, {\n    variant: \"h6\"\n  }, \"Please Wait....\")), __jsx(Box, null, __jsx(Typography, {\n    variant: \"h6\"\n  }, \"Don't refresh page or don't use back button while payment is in progress.\"))) : \"\", !loader ? __jsx(React.Fragment, null, __jsx(Grid, {\n    container: true,\n    spacing: isMd ? 2 : 2\n  }, __jsx(Grid, {\n    item: true,\n    xs: 12,\n    sm: 6,\n    md: 6\n  }, __jsx(Typography, {\n    variant: isMd ? 'h5' : 'body1',\n    className: clsx(classes.fontWeight700, classes.sectionHeader)\n  }, \"Review Your Order Details\"), __jsx(Typography, {\n    variant: isMd ? 'h5' : 'body1',\n    className: clsx(classes.fontWeight700)\n  }, courseData.data && courseData.data.title ? courseData.data.title : \"\"), __jsx(Box, {\n    pt: 5,\n    pb: 3,\n    className: classes.modualWrap\n  }, modualFinal.map(function (entity, index) {\n    return __jsx(Box, {\n      key: index,\n      display: 'flex',\n      justifyContent: \"space-between\",\n      className: classes.modualList\n    }, __jsx(Box, {\n      className: classes.modualTitle\n    }, entity.moduleName), __jsx(Box, {\n      className: classes.modualAmount\n    }, entity.amount ? \"$\".concat(entity.amount) : null));\n  })), __jsx(Box, {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    className: classes.calculationBlock\n  }, __jsx(Box, {\n    className: classes.calcTitle\n  }, \"Discount Applied : \"), __jsx(Box, {\n    className: classes.calcValue\n  }, \"\".concat(coupanCode ? \"$\".concat(coupanCode.discountedAmount) : '-'))), __jsx(Box, {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    className: classes.calculationBlock\n  }, __jsx(Box, {\n    className: classes.calcTitle\n  }, \"Total : \"), __jsx(Box, {\n    className: classes.calcValue\n  }, \"$\".concat(coupanCode ? coupanCode.grandTotal : countTotal))), __jsx(Box, {\n    display: \"flex\",\n    justifyContent: \"center\",\n    p: 3\n  }, __jsx(TextField, {\n    placeholder: \"Coupon Code\",\n    label: \"Coupon Code\",\n    variant: \"outlined\",\n    size: \"medium\",\n    name: \"couponValue\",\n    fullWidth: true,\n    type: \"couponValue\",\n    onChange: handleChange,\n    value: coupanValue ? coupanValue : formState.values.couponValue || ''\n  }), couponLoader ? __jsx(Button, {\n    variant: \"contained\",\n    color: \"secondary\",\n    className: classes.apply_btn\n  }, \"Processing....\") : __jsx(Button, {\n    variant: \"contained\",\n    color: \"secondary\",\n    onClick: handleApplyCoupon,\n    className: classes.apply_btn\n  }, \"Apply Code\")), __jsx(Box, {\n    display: \"flex\",\n    pl: 3\n  }, __jsx(\"p\", {\n    className: classes.error_msg\n  }, error))), __jsx(Grid, {\n    item: true,\n    xs: 12,\n    sm: 6,\n    md: 6\n  }, __jsx(Box, {\n    p: 2,\n    className: clsx(classes.paymentWrap, classes.root)\n  }, __jsx(Typography, {\n    variant: isMd ? 'h5' : 'body1',\n    className: clsx(classes.fontWeight700, classes.sectionHeader)\n  }, \"Payment Details\"), __jsx(Grid, {\n    container: true,\n    spacing: isMd ? 2 : 2\n  }, __jsx(Grid, {\n    item: true,\n    xs: 12,\n    sm: 6\n  }, __jsx(Typography, {\n    variant: \"subtitle1\",\n    color: \"textPrimary\",\n    className: classes.inputTitle\n  }, \"First Name\"), __jsx(TextField, {\n    placeholder: \"First name*\",\n    label: \"\",\n    variant: \"outlined\",\n    size: \"medium\",\n    fullWidth: true,\n    name: \"firstName\",\n    type: \"firstName\",\n    value: formState.values.firstName || ''\n  })), __jsx(Grid, {\n    item: true,\n    xs: 12,\n    sm: 6\n  }, __jsx(Typography, {\n    variant: \"subtitle1\",\n    color: \"textPrimary\",\n    className: classes.inputTitle\n  }, \"Last Name\"), __jsx(TextField, {\n    placeholder: \"Last Name *\",\n    label: \"\",\n    variant: \"outlined\",\n    size: \"medium\",\n    fullWidth: true,\n    name: \"lastName\",\n    type: \"lastName\",\n    value: formState.values.lastName || ''\n  })), __jsx(Grid, {\n    item: true,\n    xs: 12,\n    sm: 12\n  }, __jsx(Typography, {\n    variant: \"subtitle1\",\n    color: \"textPrimary\",\n    className: classes.inputTitle\n  }, \"E-mail\"), __jsx(TextField, {\n    placeholder: \"Email\",\n    label: \"\",\n    variant: \"outlined\",\n    size: \"medium\",\n    fullWidth: true,\n    name: \"email\",\n    type: \"email\",\n    value: formState.values.email || ''\n  })), __jsx(Grid, {\n    item: true,\n    xs: 12,\n    sm: 12\n  }, __jsx(Typography, {\n    variant: \"subtitle1\",\n    color: \"textPrimary\",\n    className: classes.inputTitle\n  }, \"Card Details*\")), __jsx(Grid, {\n    item: true,\n    xs: 12,\n    sm: 12\n  }, __jsx(Typography, {\n    variant: \"subtitle1\",\n    color: \"textPrimary\",\n    className: classes.inputTitle\n  }, \"Card Holder Name*\"), __jsx(TextField, {\n    placeholder: \"Card holder name*\",\n    label: \"\",\n    variant: \"outlined\",\n    size: \"medium\",\n    fullWidth: true,\n    name: \"cardHolderName\",\n    type: \"cardHolderName\",\n    onChange: handleChange,\n    value: formState.values.cardHolderName || ''\n  })), __jsx(Grid, {\n    item: true,\n    xs: 12,\n    sm: 12\n  }, __jsx(Button, {\n    variant: \"contained\",\n    color: \"secondary\",\n    onClick: handlePayment,\n    size: \"large\"\n  }, \"Make Payment\"))))))) : \"\"));\n};\n\nexport default OrderDetail;","map":null,"metadata":{},"sourceType":"module"}